<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <link rel="stylesheet" href="css/index_css.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
    
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.17/dist/vue.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.js"></script>
    
    
    
    <script src="https://kit.fontawesome.com/599456d19b.js" crossorigin="anonymous"></script>
    
    
    <title>HOTEL</title>
</head>
<body>
    <div id="app">       
        <nav class="navbar navbar-toggleable-md shadow-lg mb-5" style="background: black;">
                <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo02" aria-controls="navbarTogglerDemo02" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <a class="m-4" href="index.html" style="color:orange; font-size: 2em;">HOTELVENDER</a>
                
                <div class="collapse navbar-collapse p-1" id="navbarTogglerDemo02">
                    <ul class="navbar-nav mr-auto mt-2 mt-md-0">
                        <li class="nav-item active">
                            <a class="nav-link" href="#"> <span class="sr-only">(current)</span></a>
                        </li>
                        
                        <li class="nav-item">
                            <a class="nav-link" href="manageHotel.html">Manage Hotel</a>
                        </li>
                        
                        
                        
                    </ul>
                    <div class="mr-auto"></div>
                    
                    
                    
                    <form class="form-inline my-2 my-lg-0">
                        
                        <a href="login.html"><button class="btn btn-outline-warning my-2 my-sm-0 mr-2" type="button">login</button></a>
                        
                        
                        <span v-if="token">
                            
                            <div class="dropdown">
                                <a class="btn btn-warning dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <span style="color: black;">{{ user.firstName }}</span><i  style="color: black;" class="ml-2 fas fa-user-circle"></i> 
                                </a>
                                
                                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuLink">
                                    <a class="dropdown-item" href="profile.html">Profile</a>
                                    <a class="dropdown-item" href="register.html">Resgister</a>
                                    <a class="dropdown-item" href="#" @click="logout()">Logout</a>
                                </div>
                            </div>
                            
                        </span>
                        
                        
                    </form>
                </div>
            </nav>
        <div class="container">
            
            <div class="row">
                
            </div>
            
            
            <div class="card mb-4 shadow">
                <div class="card-header">
                    Room Type
                </div>
                <div class="card-body">
                    
                </div>
                
                
                
                
                <div class="table-responsive">
                    
                    <table class="table table-bordered m-2">
                        <thead>
                            <tr>
                                <th scope="col">Hotel</th>
                                <th scope="col">Start</th>
                                <th scope="col">End</th>
                                <th scope="col">Price</th>
                                <th scope="col">User</th>
                                <th scope="col">Tel</th>
                                <th scope="col"> Status</th>

                                <th scope="col">Update Status</th>

                                
                                
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="(book, index) in bookAll">
                                <th scope="row">
                                    
                                    <div v-for="i in info">
                                        <div v-if="i.hotelId == book.hotelId">
                                            {{ i.hotelName }}
                                        </div>    
                                    </div>
                                </th>
                                <td>{{ book.bookingStartDate }}</td>
                                <td>{{ book.bookingEndDate }}</td>
                                <td>{{ book.totalPrice }}<span class="badge badge-pill badge-success"></span>
                                    <td>
                                        <div v-for="user in alluser">
                                            <div v-if="user.id == book.userId">
                                                {{ user.firstName }}  
                                                
                                            </div>
                                        </div>
                                    </td>
                                   
                                    <td>
                                        <div v-for="user in alluser">
                                            <div v-if="user.id == book.userId">
                                                <div v-for="tel in user.tel">
                                                    {{ tel }}
                                                </div>  
                                            </div>
                                        </div>
                                        <td>{{ book.bookingStatus }}</td>

                                        <td>
                                                <button class="btn btn-warning shadow"  style=" border-radius: 30px;" @click="updateBooking(book.id)">Cancel</button>
                                                
                                            </td>
                                    </td>
                                </div>
                                
                                
                            </div>
                        </td>
                        
                        
                    </tr>
                </tbody>
            </table>
            
            <!-- <div class="row">
                <div class="col text-right m-2">
                    <button class="btn btn-warning">
                        Previous
                    </button>
                    <button class="btn btn-warning">
                        Next
                    </button>
                    
                </div>
            </div> -->
            
        </div>
        
    </div>
</div>
</div>


</div>

<style>
    
    .card-header {
        background: #ffe7c5;
        border: none;
        font-weight: bold;
        
    }
    
</style>





<script>
    
    
    
    Vue.component('button-counter', {
        data: function () {
            return {
                count: 0
            }
        },
        template: '<button v-on:click="count++">You clicked me {{ count }} times.</button>'
    })
    
    new Vue({
        el: '#app',
        data () {
            return {
                hotelId: '',
                info: [], // json hotel ที่ get มา
                loading: true,
                errored: false,
                message : 'hello',
                searchText: "", // ข้อความในกล่องค้นหา
                name: '',
                link: '',
                user: '',
                bookAll: '',
                alluser: '',
                token: '',
                bookid: '',
                
            }
        },
        
        computed: {
            hotelSearchResult() { // function search
                return this.info.filter(hotel => {
                    let isMatchTitle = hotel.users_id.includes(this.user.id)
                    let isMatchContent = hotel.users_id.includes(this.user.id)
                    return isMatchTitle | isMatchContent 
                })
            }
        },
        
        mounted () {
            
            
            if (localStorage.token) {
                this.token = localStorage.token;
            }
            
            
            if (localStorage.link) {
                this.link = localStorage.link;
            }
            
            
            
            
            
            axios.get('http://bookingservice-260006.appspot.com/getbookingbyhotel/'+this.link,
            {
                headers: {
                    Authorization: localStorage.token
                }
            })
            .then((response) => {
                const data = response.data; // [{}, {}]
                this.bookAll = data;
            }),
            
            axios.get('https://user-259905.appspot.com/alluser')
            .then((response) => {
                const data = response.data; // [{}, {}]
                this.alluser = data;
            })
            
            
            
            this.info = [];
            
            
            axios.get('https://user-259905.appspot.com/user/me',
            {
                headers: {
                    Authorization: localStorage.token
                }
            })
            .then((response) => {
                const data = response.data; // [{}, {}]
                this.user = data;
            }),
            
            
            axios.get('https://hotelservice.appspot.com/allhotel')
            .then((response) => {
                const data = response.data; // [{}, {}]
                this.info = data;
            })
            .catch(error => {
                console.log(error)
                this.errored = true
            })
            .finally(() => this.loading = false)
            
            
            
        },
        
        
        watch: {
            name(newName) {
                localStorage.name = newName;
            }
        },
        methods: {
            
            
            
            updateBooking(id) {
                axios.post('http://bookingservice-260006.appspot.com/updateBookingStatus/'+id, {

                    bookingStatus : "Cancel"
                    
                },
                { headers: {
                    
                    Authorization: localStorage.token
                }})
                .then((response) => {
                    const data = response.data;
                    this.user = data
                    
                });
            },
            
            
            logout() {
                axios.post('https://hotelservice.appspot.com/createhotel', {
                    
                })
                .then((response) => {
                    const data = response.data;
                    this.user = data
                    
                });
            },
            
            persist(id) {
                this.link = id
                localStorage.link = this.link;
                console.log('now pretend I did more stuff...');
            },
            
            addUser() {
                axios.post('https://hotelservice.appspot.com/createhotel', {
                    
                    hotelName : "EarthHotel",
                    country : "Thailand",
                    provinceState : "Bangkok",
                    district : "Ratchathewi",
                    street : "Payathai Rd",
                    users_id : [1, 19, 10],
                    additionalDetail : "Something like that",
                    availible : true,
                    tel : ["0910349301", "0812711778", "0818951414"],
                    email : ["Rawitgun@facebook.com", "Rawitgun@gmail.com"]
                    
                    
                })
                .then((response) => {
                    const data = response.data;
                    this.info.push(data);
                    
                });
                
                
            }
        }
    })
    
    
    
    
</script>


</body>
</html>